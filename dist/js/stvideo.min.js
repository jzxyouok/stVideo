/*! 
 * stVideo 
 * HTML5 video canvas player. Prevents video fullscreen on iPhone/iPad.
 * 
 * Licensed under the MIT license: 
 * http://www.opensource.org/licenses/mit-license.php 
 * 
 * Any and all use of this script must be accompanied by this copyright/license notice in its present form. 
 * 
 * Version: 0.8.0
 * Author: Tomasz Stabla <t.stabla@hotmail.com> (http://stabla.com)
 * Site: https://github.com/tstabla/stVideo/
 */

!function(a,b){"function"==typeof define&&define.amd?define([],function(){return b(a)}):"object"==typeof module&&module.exports?module.exports=b(a):a.stVideo=b(a)}("undefined"!=typeof global?global:this.window||this.global,function(a){"use strict";!function(a){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-b)),g=a.setTimeout(function(){c(e+f)},f);return b=e+f,g}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(a);var b=function(a,b){return this.useCanvas=/iPhone|iPad|iPod/i.test(navigator.userAgent),this.element=document.querySelector(a),this.defaults={force:""},this.settings=this.getSettings(b),(this.settings.mp4||this.settings.webm||this.settings.ogg)&&this.settings.width&&this.settings.height?("video"===this.settings.force?this.useCanvas=!1:"canvas"===this.settings.force&&(this.useCanvas=!0),this.classNames={init:"stvideo-box",error:"stvideo-box--error",isPlaying:"stvideo-box--is-playing",isPaused:"stvideo-box--is-paused",isEnded:"stvideo-box--is-ended",isMuted:"stvideo-box--is-muted",hasAudio:"stvideo-box--has-audio",player:"stvideo-box__player",poster:"stvideo-box__poster",play:"stvideo-box__play",playPause:"stvideo-box__play-pause",controls:"stvideo-box__controls",timeline:"stvideo-box__timeline",progress:"stvideo-box__progress",duration:"stvideo-box__duration",volume:"stvideo-box__volume"},this.eventsUserCollection=[],this.eventsVideoCollection=[],this.eventsControlsCollection=[],void this.initPlayer()):(this.isError=!0,void this.error.checkSettings())};return b.prototype.getSettings=function(a){var b,c,d;a||(b=this.element.getAttribute("data-stvideo"),b=b.replace(/\'/g,'"'),a=JSON.parse(b)),c=this.defaults;for(d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c},b.prototype.initPlayer=function(){var a,b,c,d,e,f;return this.element.classList.add(this.classNames.init),c=document.createElement("video"),c.setAttribute("width",this.settings.width),c.setAttribute("height",this.settings.height),a=this.supportedVideoFormat(c),!a||this.useCanvas&&!this.settings.mp4||!this.settings[a.ext]?void this.error.badVideoFormat.call(this):(d=document.createElement("source"),d.setAttribute("src",this.settings[a.ext]),d.setAttribute("type",a.type),c.appendChild(d),b=document.createElement("div"),b.classList.add(this.classNames.player),this.useCanvas?(e=document.createElement("canvas"),e.setAttribute("width",this.settings.width),e.setAttribute("height",this.settings.height),f=e.getContext("2d"),f.fillStyle="#ffffff",f.fillRect(0,0,this.settings.width,this.settings.height),f.drawImage(c,0,0,this.settings.width,this.settings.height),this.canvasContext=f,b.appendChild(e)):b.appendChild(c),this.element.appendChild(b),c.load(),this.video=c,this.playerControls(),this.addVideoListeners(),void this.addControlsListeners())},b.prototype.supportedVideoFormat=function(a){var b={};return"probably"==a.canPlayType("video/webm")||"maybe"==a.canPlayType("video/webm")?(b.ext="webm",b.type='video/webm; codecs="vp8, vorbis"'):"probably"==a.canPlayType("video/mp4")||"maybe"==a.canPlayType("video/mp4")?(b.ext="mp4",b.type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"'):"probably"!=a.canPlayType("video/ogg")&&"maybe"!=a.canPlayType("video/ogg")||(b.ext="ogg",b.type='video/ogg; codecs="theora, vorbis"'),b},b.prototype.videoAudio=function(a){var b,c,d=this;a.mozHasAudio||Boolean(a.webkitAudioDecodedByteCount)||Boolean(a.audioTracks&&a.audioTracks.length)?(this.hasAudio=!0,this.element.classList.add(this.classNames.hasAudio),c=document.createElement("div"),c.classList.add(this.classNames.volume),this.elControls.appendChild(c),this.elVolume=c,this.elVolume.addEventListener("click",b=function(){d.isMuted?d.video.volume=1:d.video.volume=0}),this.eventsControlsCollection.push(b)):this.hasAudio=!1},b.prototype.playerControls=function(){var a,b,c,d,e,f,g;this.settings.poster&&(a=document.createElement("div"),a.classList.add(this.classNames.poster),a.style.backgroundImage="url("+this.settings.poster+")",this.element.appendChild(a)),f=document.createElement("div"),f.classList.add(this.classNames.play),b=document.createElement("div"),b.classList.add(this.classNames.controls),e=document.createElement("div"),e.classList.add(this.classNames.playPause),c=document.createElement("div"),c.classList.add(this.classNames.timeline),d=document.createElement("div"),d.classList.add(this.classNames.progress),g=document.createElement("div"),g.classList.add(this.classNames.duration),c.appendChild(d),b.appendChild(c),b.appendChild(e),b.appendChild(g),this.element.appendChild(b),this.element.appendChild(f),this.elControls=b,this.elPlay=f,this.elPlayPause=e,this.elProgress=d,this.elDuration=g},b.prototype.addVideoListeners=function(){var a,b=this;this.video.addEventListener("loadedmetadata",a=function(){b.videoAudio(this)}),b.eventsVideoCollection.push(a),this.video.addEventListener("canplaythrough",a=function(){b.useCanvas&&b.canvasDrawFrame(),b.progressUpdate()}),b.eventsVideoCollection.push(a),b.useCanvas||(this.video.addEventListener("play",a=function(){b.changeState("play",!0),b.changeState("end",!1)}),b.eventsVideoCollection.push(a),this.video.addEventListener("pause",a=function(){b.changeState("pause",!0),b.changeState("play",!1)}),b.eventsVideoCollection.push(a),this.video.addEventListener("ended",a=function(){b.changeState("end",!0),b.changeState("play",!1)}),b.eventsVideoCollection.push(a)),this.video.addEventListener("timeupdate",a=function(){b.useCanvas&&b.canvasDrawFrame(),b.progressUpdate()}),b.eventsVideoCollection.push(a),this.video.addEventListener("volumechange",a=function(){this.volume>0?b.changeState("muted",!1):b.changeState("muted",!0)}),b.eventsVideoCollection.push(a),this.video.addEventListener("error",a=function(a){b.isError=!0,b.error.custom(a)}),b.eventsVideoCollection.push(a)},b.prototype.addControlsListeners=function(a){var b,c=this;this.elPlay.addEventListener("click",b=function(){c.isPlaying?c.pause():c.play()}),c.eventsControlsCollection.push(b),this.elPlayPause.addEventListener("click",b=function(){c.isPlaying?c.pause():c.play()}),c.eventsControlsCollection.push(b)},b.prototype.canvasControl=function(b){"play"==b||"play"==b&&this.isEnded?(this.isEnded&&(this.changeState("end",!1),this.video.currentTime=0,this.lastTime=Date.now()),this.changeState("play",!0),this.animationFrame=a.requestAnimationFrame(this.canvasFrameUpdate.bind(this))):"pause"!=b&&"ended"!=b||("ended"==b?this.changeState("end",!0):this.changeState("pause",!0),this.changeState("play",!1),a.cancelAnimationFrame(this.animationFrame))},b.prototype.canvasFrameUpdate=function(){var b=Date.now(),c=(b-(this.lastTime||b))/1e3;(!c||c>=.04)&&(this.video.currentTime=this.video.currentTime+c,this.lastTime=b),this.video.currentTime>=this.video.duration?this.canvasControl("ended"):this.animationFrame=a.requestAnimationFrame(this.canvasFrameUpdate.bind(this))},b.prototype.canvasDrawFrame=function(){this.canvasContext.drawImage(this.video,0,0,this.settings.width,this.settings.height)},b.prototype.progressUpdate=function(){var a=this.video.currentTime,b=this.video.duration,c=(a/b).toFixed(4);this.elProgress.style.width=100*+c+"%",this.elDuration.innerText=this.formatTime(a)+" / "+this.formatTime(b)},b.prototype.formatTime=function(a){var b,c;return b=Math.floor(a/60),b=b>=10?b:"0"+b,c=Math.floor(a%60),c=c>=10?c:"0"+c,b+":"+c},b.prototype.error={badVideoFormat:function(){this.useCanvas?console.error("Apple devices support only .mp4 format"):console.error("Best use .webm and .mp4 video formats"),this.element.classList.add(this.classNames.error)},checkSettings:function(){console.error("Check all required settings"),this.element.classList.add(this.classNames.error)},custom:function(a){console.error(a),this.element.classList.add(this.classNames.error)}},b.prototype.on=function(a,b){if(!this.isError){var c,d=this;this.allowedEvents.indexOf(a)!=-1&&(this.video.addEventListener(a,c=function(){b.call(this)}),d.eventsUserCollection.push(c))}},b.prototype.play=function(){this.isError||(this.lastTime=Date.now(),this.useCanvas?this.canvasControl("play"):this.video.play())},b.prototype.pause=function(){this.isError||this.isPlaying&&(this.useCanvas?this.canvasControl("pause"):this.video.pause())},b.prototype.changeState=function(a,b){var c=this.element.classList;"play"==a&&(this.isPlaying=b,b?c.add(this.classNames.isPlaying):c.remove(this.classNames.isPlaying)),"pause"==a&&(this.isPaused=b,b?c.add(this.classNames.isPaused):c.remove(this.classNames.isPaused)),"end"==a&&(this.isEnded=b,b?c.add(this.classNames.isEnded):c.remove(this.classNames.isEnded)),"muted"==a&&(this.isMuted=b,b?c.add(this.classNames.isMuted):c.remove(this.classNames.isMuted))},b.prototype.destroy=function(){},b});
//# sourceMappingURL=stvideo.min.js.map